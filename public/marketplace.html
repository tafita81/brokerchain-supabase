<!DOCTYPE html>
<html lang="en" class="bg-black text-white">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BrokerChain Live Leads</title>
<style>
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Inter","Roboto","Helvetica",sans-serif;background:#000;color:#fff;margin:0;padding:1rem;}
h1{font-size:1.1rem;font-weight:600;margin:0 0 .5rem;}
p{font-size:.8rem;line-height:1.3;color:#9ca3af;margin:.25rem 0;}
.section{max-width:1200px;margin:0 auto;border:1px solid #1f2937;border-radius:.75rem;background:#0a0a0a;padding:1rem;margin-bottom:1rem;}
table{width:100%;border-collapse:collapse;font-size:.7rem;}
th{color:#9ca3af;font-weight:500;text-align:left;border-bottom:1px solid #1f2937;padding-bottom:.5rem;}
td{vertical-align:top;font-size:.7rem;color:#fff;}
.small{font-size:.7rem;color:#6b7280;line-height:1.3;}
.badge{display:inline-block;font-size:.6rem;background:#1f2937;color:#fff;border-radius:.4rem;padding:.25rem .5rem;border:1px solid #374151;margin-right:.5rem;margin-bottom:.5rem;}
</style>
</head>
<body>

<div class="section">
  <div class="badge">Nationwide US + DC</div>
  <div class="badge">Emergency Dispatch</div>
  <div class="badge">Micro‑Purchase &lt;$15k</div>
  <div class="badge">Solar Credit Rush</div>
  <div class="badge">Global B2B Sourcing</div>

  <h1>Live Leads / Dispatch Deals</h1>
  <p>Aqui você vê pedidos já capturados e em rota de despacho. Cada linha pode virar $$$ agora.</p>

  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>Tenant</th>
          <th>State</th>
          <th>Need</th>
          <th>Urgency</th>
          <th>Buyer</th>
          <th>Status</th>
          <th>Source</th>
          <th>Supplier</th>
        </tr>
      </thead>
      <tbody id="mpRows">
      </tbody>
    </table>
  </div>

  <div class="small" style="margin-top:.5rem;">
    Linha 1 = lead / match comercial.<br/>
    Linha 2 = timestamps Stripe/DocuSign, autorização &lt;15k, alerta.
  </div>
</div>

<script>
async function loadLeads(){
  const r = await fetch('/api/marketplace');
  const data = await r.json();
  const rows = data.leads||[];
  const tbody = document.getElementById('mpRows');
  tbody.innerHTML = rows.map(L => `
    <tr style="border-bottom:1px solid #1f2937;">
      <td style="padding:.25rem .5rem;">${L.tenant||''}</td>
      <td style="padding:.25rem .5rem;">${L.state||''}</td>
      <td style="padding:.25rem .5rem;">${L.need||''}</td>
      <td style="padding:.25rem .5rem;">${L.urgency||''}</td>
      <td style="padding:.25rem .5rem;">${L.buyer_type||''}</td>
      <td style="padding:.25rem .5rem;">${L.status||''}</td>
      <td style="padding:.25rem .5rem;">${L.source||''}</td>
      <td style="padding:.25rem .5rem;">${L.assigned_supplier_contact ? (L.assigned_supplier_contact.business_name||'') : ''}</td>
    </tr>
    <tr style="border-bottom:1px solid #0f172a;color:#9ca3af;font-size:.6rem;">
      <td style="padding:.25rem .5rem;" colspan="8">
        Dispatch time: ${L.dispatch_assigned_utc||''}<br/>
        Stripe: ${L.stripe_checkout_url ? `<a style="color:#818cf8;text-decoration:underline;" href="${L.stripe_checkout_url}" target="_blank">checkout link</a>` : ''} ${L.stripe_created_utc ? '('+L.stripe_created_utc+')':''}<br/>
        DocuSign: ${L.docusign_envelope_id||''} ${L.docusign_created_utc ? '('+L.docusign_created_utc+')':''}<br/>
        Auth &lt;15k: ${L.authorized_under_15k||''} &nbsp; Block: ${L.billing_block_reason||''}<br/>
        Alert pending: ${L.alert_pending? 'YES: '+(L.alert_reason||'') : 'no'}
      </td>
    </tr>
  `).join('');
}
loadLeads();
</script>

</body>
</html>
