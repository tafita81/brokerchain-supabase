<!DOCTYPE html>
<html lang="en" style="background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>BrokerChain • Buyers</title>
<style>
body{margin:0;padding:16px;background:#000;color:#fff;font-size:16px;line-height:1.4rem;}
h1{margin:0 0 12px 0;font-size:1.1rem;font-weight:600;color:#fff;}
.small{font-size:0.75rem;color:#aaa;line-height:1rem;margin-bottom:12px;}
.table-wrap{border:1px solid #333;border-radius:8px;overflow-x:auto;font-size:0.7rem;line-height:1rem;}
table{width:100%;border-collapse:collapse;min-width:800px;}
th,td{border-bottom:1px solid #333;text-align:left;padding:6px 8px;vertical-align:top;color:#fff;font-weight:400;}
.btn{display:inline-block;background:#111;color:#fff;border:1px solid #444;border-radius:6px;font-size:0.8rem;padding:8px 10px;text-decoration:none;margin-right:8px;}
.btn:active{background:#222;}
.header-row{display:flex;flex-wrap:wrap;align-items:flex-start;gap:8px;margin-bottom:12px;}
</style>
</head>
<body>

<div class="header-row">
  <a class="btn" href="/dashboard.html">← Dashboard</a>
  <h1 style="flex:1;min-width:200px;">Buyers / Requestors</h1>
</div>

<div class="small">
Memória estratégica de todo mundo que já gritou “preciso agora”.
Inclui quem parece ter poder de compra rápida (&lt;$15k cartão governo),
em qual estado ele pediu ajuda e qual tipo de dor (gerador, telhado, bomba etc).
</div>

<div class="table-wrap">
  <table id="buyers_table">
    <thead>
      <tr>
        <th>ID</th>
        <th>First Seen (UTC)</th>
        <th>Last Seen (UTC)</th>
        <th>Contact</th>
        <th>Authorized &lt;$15k</th>
        <th>Buyer Type</th>
        <th>States</th>
        <th>Intents / Tenants</th>
      </tr>
    </thead>
    <tbody id="buyers_tbody">
      <tr><td colspan="8">Loading…</td></tr>
    </tbody>
  </table>
</div>

<script>
async function loadBuyers(){
  const r = await fetch('/api/buyers-all');
  const j = await r.json();
  const arr = j.buyers || [];
  const tbody = document.getElementById('buyers_tbody');
  tbody.innerHTML = "";
  arr.slice().reverse().forEach(B => {
    const statesList = Object.keys(B.states||{}).join(", ");
    const intentsList = Object.keys(B.intents||{}).join(", ");
    const contact = (B.contact_email||"") + " " + (B.contact_phone||"");
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${B.id||''}</td>
      <td>${B.first_seen_utc||''}</td>
      <td>${B.last_seen_utc||''}</td>
      <td>${contact.replace(/</g,'&lt;')}</td>
      <td>${B.authorized_under_15k ? 'YES':'no'}</td>
      <td>${(B.buyer_type||'').replace(/</g,'&lt;')}</td>
      <td>${statesList.replace(/</g,'&lt;')}</td>
      <td>${intentsList.replace(/</g,'&lt;')}</td>
    `;
    tbody.appendChild(tr);
  });
}
loadBuyers();
</script>

</body>
</html>
